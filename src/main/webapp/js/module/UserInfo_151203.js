define("module/UserInfo",["lib/jquery","util/artTemplate","module/Dialog","module/Validator","util/ajaxPromise"],function(e){"use strict";var l,o,a,s,t,i,n,r,c,d,u;return l=e("lib/jquery"),o=e("util/artTemplate"),s=e("module/Dialog"),t=e("module/Validator"),i=e("util/ajaxPromise"),r=function(e){return i({url:window.basePath+"role/getRoleList",data:{filter:e},type:"GET",dataType:"json"}).then(function(e){var l;return l=e.result,l.unshift({id:"",name:"请选择"}),l})},d=o.compile(["{{each options}}",'<option value="{{$value.id}}">{{$value.name}}</option>',"{{/each}}"].join("")),u=o.compile(["{{each info}}",'<option {{if id===$value.id+""}}selected="selected"{{/if}} value="{{$value.id}}">{{$value.name}}</option>',"{{/each}}"].join("")),c=o.compile(['<div class="form-horizontal">','<div class="form-group">','<label class="col-sm-4 control-label">密码：</label>','<div class="col-sm-8">','<input type="text" value="" class="password form-control"  maxLength="30"/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">账号：</label>','<div class="col-sm-8">','<input type="text" value="{{userKey}}" class="user-key form-control" disabled/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">姓名：</label>','<div class="col-sm-8">','<input type="text" value="{{userName}}" class="user-name form-control"  maxLength="30"/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">角色：</label>','<div class="col-sm-8">','<select class="role form-control">',"{{each roleInfo}}",'<option {{if role===$value.id}}selected="selected"{{/if}} value="{{$value.id}}">{{$value.name}}</option>',"{{/each}}","</select>","</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">状态：</label>','<div class="col-sm-8">','<select class="status form-control">','<option {{if status===0}}selected="selected"{{/if}} value="0">启用</option>','<option {{if status===1}}selected="selected"{{/if}} value="1">禁用</option>',"</select>","</div>","</div>","</div>"].join("")),a=new s("modal-dialog"),n={initRole:function(e,o){"string"===l.type(e)&&(e=l("#"+e)),r(0).then(function(l){e.append(u({info:l,id:o}))})},addMember:function(e){r(0).then(function(l){a.show({sizeClass:"modal-sm",title:"创建用户",content:['<div class="form-horizontal">','<div class="form-group">','<label class="col-sm-4 control-label">密码：</label>','<div class="col-sm-8">','<input type="text" value="" class="password form-control"  maxLength="30"/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">账号：</label>','<div class="col-sm-8">','<input type="text" value="" class="user-key form-control"/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">姓名：</label>','<div class="col-sm-8">','<input type="text" value="" class="user-name form-control" maxLength="30"/>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-4 control-label">角色：</label>','<div class="col-sm-8">','<select class="role form-control"></select>',"</div>","</div>","</div>"].join(""),source:e,initial:function(){var e,o=this;e=o._container,e.find(".password").val(""),e.find(".user-key").val(""),e.find(".user-name").val(""),e.find(".role").html(d({options:l}))},confirm:function(){var e,l,o,a=this,s=new t,n={};return e=a._container,l=e.find(".user-key"),n.userKey=l.val().trim(),o=e.find(".password"),n.password=o.val(),n.groupName=e.find(".role").val(),s.add(n.userKey,"isNotEmpty",function(){alert("账号不能为空"),l.val("").focus()}).add(n.password,"isNotEmpty",function(){alert("密码不能为空"),o.val("").focus()}).add(n.groupName,"isNotEmpty",function(){alert("请选择角色")}),s.start()?(n.userName=e.find(".user-name").val().trim(),void i({url:window.basePath+"user/addUserInfo",type:"GET",data:n,dataType:"json"}).then(function(e){window.location.reload()},function(){a.enableConfirm()})):void a.enableConfirm()}})})},editMember:function(e){r(0).then(function(o){e.roleInfo=o,a.show({sizeClass:"modal-sm",title:"编辑用户",content:c(e),force:1,confirm:function(){var o,a=this,s=new t,n={};return o=a._container,n.groupName=o.find(".role").val(),s.add(n.groupName,"isNotEmpty",function(){alert("请选择角色")}),s.start()?(l.extend(n,{userKey:e.userKey,id:e.userId,userName:o.find(".user-name").val().trim(),password:o.find(".password").val(),status:o.find(".status").val(),teamId:o.find(".team").val()}),void i({url:window.basePath+"user/updateUserInfo",type:"GET",data:n,dataType:"json"}).then(function(e){window.location.reload()},function(){a.enableConfirm()})):void a.enableConfirm()}})})}}});